"0","cumpro <- cumsum(res.pca$sdev^2 / sum(res.pca$sdev^2)*100)"
"0","variances <- data.frame((res.pca$sdev^2/sum(res.pca$sdev^2))*100)"
"0","variances$PC <- c(1:31)"
"0","variances$cumpro <- cumpro"
"0","colnames(variances) <- c(""Variance_Proportion"", ""PC"", ""CumVar"")"
"0",""
"0","newrow <- subset(variances, PC == 31)"
"0","newrow$PC <- 31.5"
"0","variances <- plyr::rbind.fill(variances, newrow)"
"0",""
"0","linecolors <- c(""Component Variance"" = ""maroon4"","
"0","                ""Cumulative Variance"" = ""green4"")"
"0",""
"0","p.var <- variances %>%"
"0","  ggplot(data=.) +"
"0","  geom_bar(data=subset(variances, PC < 32), mapping=aes(x=PC, y=Variance_Proportion),"
"0","           stat=""identity"", fill=""steelblue"") +"
"0","  geom_line(aes(color=""Component Variance"", x=PC, y=Variance_Proportion), "
"0","            size=0.7, data=subset(variances, PC < 31.1), show.legend=F) +"
"0","  geom_line(aes(x=PC, y=CumVar, color=""Cumulative Variance""), size=0.7,"
"0","            data=subset(variances, PC < 32)) +"
"0","  geom_point(aes(x=PC, y=Variance_Proportion),data=subset(variances, PC < 31.1), size=1.5) +"
"0","  scale_colour_manual(name="""",values=linecolors, "
"0","                      guide = guide_legend(override.aes=list(size=2))) + "
"0","  theme_minimal() +"
"0","  ylab(""Percentage of Variance Explained"") +"
"0","  xlab(""Principal Component"") +"
"0","  ggtitle(""Principal Components\nContribution to Subject Variance"") +"
"0","  xlim(c(0.5, 31.5)) +"
"0","  scale_y_continuous(breaks=seq(0, 100, 10),"
"0","                     sec.axis = dup_axis(name="""")) +"
"0","  theme(plot.title = element_text(hjust=0.5, size=14),"
"0","        axis.text = element_text(size=12),"
"0","        panel.grid = element_blank(),"
"0","        legend.position=""bottom"","
"0","        legend.text = element_text(size=12))"
"0",""
"0","ggplotly(p.var, tooltip=c(""x"",""y"")) %>% "
"0","  layout(legend = list(orientation = ""h"", y=-0.2))"
